# 주문 엑셀 Ingest → 표준화 → 배정 플랫폼 (초안)

작성일: 2026-02-08

## 목표
- 쿠팡/네이버/스마트스토어 등 **각기 다른 주문 형식**을 하나의 표준 주문 스키마로 통합
- 직원이 하던 “주문서 복붙/옮겨적기” 업무를 자동화
- 오류/불명확 주문은 자동 검증으로 분리해 운영자 확인 큐로 보냄
- 결과를 우리 플랫폼에 `upsert`(부분 업데이트)로 반영

---

## 핵심 아이디어
- 브라우저 자동화는 유지보수 지옥이 될 수 있으므로,
  - **다운로드(엑셀 받기)는 승인형(반자동)으로 시작**
  - **다운로드 이후 파싱/표준화/업로드/검증은 100% 자동**

---

## End-to-End 플로우

### Step A) 주문 알람 감지(Trigger)
- 네이버/쿠팡/스스에서 주문 알림이 오면
- OpenClaw가 “다운로드 필요” 작업을 큐에 적재

가능한 트리거:
- 이메일/푸시 알림
- 셀러센터 내 알림
- 일정 주기 폴링(예: 10~30분)


### Step B) 엑셀 다운로드 (승인형으로 시작)
- OpenClaw가 셀러센터 접속 → 다운로드 화면까지 네비게이션
- 마지막 “다운로드 버튼 클릭”은 **승인 1번** 받고 실행
- 안정화 이후 자동 클릭으로 전환 가능

왜 승인형이 좋은가:
- UI 변경/세션 만료/2FA 등 예외를 사람이 즉시 복구
- 운영이 ‘끊기지’ 않음


### Step C) 파일 감지 + 파싱/표준화 (100% 자동)
- 엑셀 파일이 떨어지는 폴더를 정함
  - 예: `~/Downloads/orders/<store>/`
- OpenClaw가 신규 파일을 감지
- 파싱 후 표준 스키마로 변환
- 주문번호 기반 **idempotent upsert**


### Step D) 자동 검증 + 인간 확인 큐
자동 검증 예시:
- 주소 누락/형식 이상
- 수령인 연락처 누락
- 문구 길이 초과/금칙어
- 배송시간 불가능(당일/심야)
- 옵션 불명확(색/사이즈/상품)

결과:
- 정상 → 플랫폼 업로드
- 의심/누락 → 검증 큐로 보내고 텔레그램 알림


### Step E) 우리 플랫폼 반영(부분 업데이트)
- API로 `orders/upsert`(배치 가능)
- 변경 사항만 부분 업데이트
- 업로드 결과/에러는 텔레그램 관제로 보고

---

## 노드(맥미니) 다수 사용 시 장점
- 스토어/계정별 세션 분리(10개+ 운영 안정)
- 장애 격리 + 재시도
- 피크타임 병렬 처리

---

## 필요한 입력(샘플/결정)
1) 쿠팡 주문 엑셀 샘플 1개
2) 네이버/스스 주문 엑셀 샘플 1개
3) 우리 플랫폼 표준 주문서(없으면 새로 정의)
4) 다운로드 주기(10분/30분/1시간)

---

## 산출물(다음 단계)
- 표준 주문 스키마(테이블/필드)
- 스토어별 컬럼 매핑(엑셀 → 표준)
- 검증 규칙 리스트
- `orders/upsert` API 스펙
- OpenClaw 워크플로(다운로드 승인형 + 파싱/업로드 자동)
